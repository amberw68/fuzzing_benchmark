FROM ubuntu:16.04


# Enable LLVM-10.0 in ubuntu 14.04
RUN apt-get update
## && apt-get install -y --no-install-recommends curl ca-certificates gnupg2 apt-transport-https software-properties-common \
# && echo 'deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-10 main' >> /etc/apt/sources.list.d/llvm10.list \
# && echo 'deb-src http://apt.llvm.org/xenial/ llvm-toolchain-xenial-10 main' >> /etc/apt/sources.list.d/llvm10.list \
# && curl https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -

# Install common dependencies
RUN apt-get -y update && \
    apt-get -y install sudo \ 
    apt-utils \
    libexpat1-dev \
    build-essential \
    openssl \
    wget \
    autoconf \
    vim \
    clang \
    gdb \
    netcat


# Add a new user ubuntu, pass: ubuntu
RUN groupadd ubuntu && \
    useradd -rm -d /home/ubuntu -s /bin/bash -g ubuntu -G sudo -u 1000 ubuntu -p "$(openssl passwd -1 ubuntu)"

# Use ubuntu as default username
USER ubuntu
WORKDIR /home/ubuntu

COPY --chown=ubuntu:ubuntu poc_0.tiff  /home/ubuntu/poc_0.tiff
#COPY --chown=ubuntu:ubuntu command.rtsp /home/ubuntu/command.rtsp
#COPY --chown=ubuntu:ubuntu poc.sh /home/ubuntu/poc.sh



# Download binutils
RUN cd /home/ubuntu && \
    wget --no-check-certificate https://sourceforge.net/projects/podofo/files/podofo/0.9.5/podofo-0.9.5-rc1.tar.gz/download && \
    tar -zxvf podofo-0.9.5-rc1.tar.gz && \
    cd podofo-0.9.5-rc1 && \
    make CFLAGS="-fsanitize=address" config && \
    ./configure --disable-xmp --without-zlib --enable-shared=no --enable-static=yes && \
    make

USER root

RUN cd /home/ubuntu/exiv2-0.26/ &&\
    make install

USER ubuntu

#    ./genMakefiles linux-no-openssl && \
#    make C_COMPILER=clang-10 CPLUSPLUS_COMPILER=clang++-10 CFLAGS="-g -fsanitize=address" CXXFLAGS="-g -fsanitize=address" LINK="clang++-10 -fsanitize=address -o " all


## Set up mp3 resource
#RUN wget https://file-examples.com/wp-content/uploads/2017/11/file_example_MP3_700KB.mp3
