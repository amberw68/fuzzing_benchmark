FROM ubuntu:16.04


# Enable LLVM-10.0 in ubuntu 16.04
RUN apt-get update \
 && apt-get install -y --no-install-recommends curl ca-certificates gnupg2 apt-transport-https software-properties-common \
 && echo 'deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-10 main' >> /etc/apt/sources.list.d/llvm10.list \
 && echo 'deb-src http://apt.llvm.org/xenial/ llvm-toolchain-xenial-10 main' >> /etc/apt/sources.list.d/llvm10.list \
 && curl https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -

# Install common dependencies
RUN apt-get -y update && \
    apt-get -y install sudo \ 
    apt-utils \
    build-essential \
    openssl \
    wget \
    vim \
    clang-10 \
    python3-dev \
    gdb \
    netcat

# Add a new user ubuntu, pass: ubuntu
RUN groupadd ubuntu && \
    useradd -rm -d /home/ubuntu -s /bin/bash -g ubuntu -G sudo -u 1000 ubuntu -p "$(openssl passwd -1 ubuntu)"

# Use ubuntu as default username
USER ubuntu
WORKDIR /home/ubuntu

COPY --chown=ubuntu:ubuntu  poc.sh /home/ubuntu/poc.sh
COPY --chown=ubuntu:ubuntu  leak /home/ubuntu/leak


# Compile Live555
RUN cd /home/ubuntu && \
    wget https://download.videolan.org/contrib/live555/live.2021.08.09.tar.gz && \
    tar -zxvf live.2021.08.09.tar.gz && \
    cd live && \
    ./genMakefiles linux-no-openssl && \
    make C_COMPILER=clang-10 CPLUSPLUS_COMPILER=clang++-10 CFLAGS="-g -fsanitize=address" CXXFLAGS="-g -fsanitize=address" LINK="clang++-10 -fsanitize=address -o " all && \
    wget https://filesamples.com/samples/audio/ac3/sample1.ac3 -O testProgs/test.ac3

