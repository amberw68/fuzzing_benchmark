FROM ubuntu:14.04


# Enable LLVM-10.0 in ubuntu 14.04
RUN apt-get update
## && apt-get install -y --no-install-recommends curl ca-certificates gnupg2 apt-transport-https software-properties-common \
# && echo 'deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-10 main' >> /etc/apt/sources.list.d/llvm10.list \
# && echo 'deb-src http://apt.llvm.org/xenial/ llvm-toolchain-xenial-10 main' >> /etc/apt/sources.list.d/llvm10.list \
# && curl https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -

# Install common dependencies
RUN apt-get -y update && \
    apt-get -y install sudo \ 
    apt-utils \
    build-essential \
    openssl \
    wget \
    vim \
    clang-3.4 \
    gdb \
    netcat

# Add a new user ubuntu, pass: ubuntu
RUN groupadd ubuntu && \
    useradd -rm -d /home/ubuntu -s /bin/bash -g ubuntu -G sudo -u 1000 ubuntu -p "$(openssl passwd -1 ubuntu)"

# Use ubuntu as default username
USER ubuntu
WORKDIR /home/ubuntu

COPY --chown=ubuntu:ubuntu bug_3.o /home/ubuntu/bug_3.o
COPY --chown=ubuntu:ubuntu bug_5.o /home/ubuntu/bug_5.o
COPY --chown=ubuntu:ubuntu bug_7 /home/ubuntu/bug_7
#COPY --chown=ubuntu:ubuntu command.rtsp /home/ubuntu/command.rtsp
#COPY --chown=ubuntu:ubuntu poc.sh /home/ubuntu/poc.sh



# Download binutils
RUN cd /home/ubuntu && \
    wget --no-check-certificate https://ftp.gnu.org/gnu/binutils/binutils-2.27.tar.gz && \
    tar -zxvf binutils-2.27.tar.gz && \
    cd binutils-2.27 && \
    mkdir build && \
    cd build && \ 
    CC=clang CFLAGS="-DFORTIFY_SOURCE=2 -fstack-protector-all -fsanitize=undefined,address -fno-omit-frame-pointer -g -Wno-error" ../configure --disable-shared --disable-gdb --disable-libdecnumber --disable-readline --disable-sim && \
    make

#    ./genMakefiles linux-no-openssl && \
#    make C_COMPILER=clang-10 CPLUSPLUS_COMPILER=clang++-10 CFLAGS="-g -fsanitize=address" CXXFLAGS="-g -fsanitize=address" LINK="clang++-10 -fsanitize=address -o " all


## Set up mp3 resource
#RUN wget https://file-examples.com/wp-content/uploads/2017/11/file_example_MP3_700KB.mp3
